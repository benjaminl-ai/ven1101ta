<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VEN1101 TA Revision</title>
    <style>
        :root { --p1: #4a90e2; --p2: #00b894; --p3: #f39c12; --bg: #f8f9fa; --dark: #2d3436; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--dark); overflow: hidden; }
        .page { display: none; height: 100vh; padding: 10px; box-sizing: border-box; animation: fadeIn 0.3s; }
        .page.active { display: flex; flex-direction: column; }
        .home-screen { display: flex; flex-direction: column; justify-content: center; height: 100%; text-align: center; }
        .menu-grid { display: flex; flex-direction: column; gap: 10px; padding: 0 10px; }
        .menu-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; }
        .menu-card h2 { margin: 0; font-size: 1.1rem; line-height: 1.4; }
        .menu-card span { display: block; font-size: 0.9rem; color: #666; font-weight: normal; margin-top: 4px; }
        .level-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-exit { background: none; border: none; color: var(--p1); font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .level-indicator { font-size: 0.85rem; font-weight: bold; color: var(--p1); background: #eef2ff; padding: 4px 12px; border-radius: 15px; text-align: right; line-height: 1.2; }
        .content { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        .img-box { width: 100%; height: 140px; background: #eee; border-radius: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .dropzone { border-bottom: 2px solid var(--p1); min-height: 40px; margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 5px; padding: 5px; background: #f0f7ff; border-radius: 8px; font-size: 0.9rem; color: #888; }
        .word-pool { display: flex; flex-wrap: wrap; gap: 6px; overflow-y: auto; max-height: 100px; padding: 5px; }
        .word { padding: 6px 10px; background: white; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: 0.2s; }
        .word:active { transform: scale(0.95); background: #f0f0f0; }
        .note-area { background: #fff9db; padding: 10px; border-radius: 8px; border-left: 4px solid var(--p3); font-size: 0.75rem; line-height: 1.4; margin-bottom: 10px; overflow-y: auto; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; }
        .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 20px; text-align: center; width: 85%; max-width: 350px; z-index: 101; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 10px; margin-top: 8px; font-weight: bold; cursor: pointer; font-size: 0.95rem; }
        .btn-record { background: var(--p1); color: white; }
        .btn-listen { background: #eef2ff; color: var(--p1); }
        .recording { background: #d63031 !important; animation: pulse 1.5s infinite; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="page-home" class="page active">
    <div class="home-screen">
        <h1 style="color:var(--p1); font-size: 1.5rem; margin-top: 0;">ğŸ› ï¸ VEN1101 TA Revision</h1>
        <div class="menu-grid">
            <div class="menu-card" onclick="startL(1)">
                <h2>ğŸ§© Level 1<span>Sentence Building / å¥å­é‡çµ„</span></h2>
            </div>
            <div class="menu-card" onclick="startL(2)">
                <h2>ğŸ—£ï¸ Level 2<span>Listen & Repeat / è½èªªç·´ç¿’</span></h2>
            </div>
            <div class="menu-card" onclick="startL(3)">
                <h2>â“ Level 3<span>Troubleshooting / æ•…éšœæ’é™¤</span></h2>
            </div>
        </div>
    </div>
</div>

<div id="page-practice" class="page">
    <div class="level-header">
        <button onclick="goHome()" class="btn-exit">â† Exit é›¢é–‹</button>
        <div id="level-indicator" class="level-indicator"></div>
    </div>
    <div id="main-content" class="content"></div>
</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
    <div id="pop-icon" style="font-size:2.5rem;"></div>
    <h3 id="pop-title" style="margin:5px 0; font-size: 1.1rem;"></h3>
    <div id="pop-text" style="font-size:0.85rem; color:#666; margin-bottom:15px; line-height:1.4;"></div>
    <button class="btn-action btn-record" onclick="closePopup()">Continue / ç¹¼çºŒ</button>
</div>

<script>
    let currentL = 1, currentStep = 0, currentQ = null;
    const l1Data = [
        { img: "lightswitch1.jpg", words: ["First,", "switch off", "the", "main power."], correct: "First, switch off the main power.", chi: "é¦–å…ˆï¼Œé—œæ‰ç¸½é›»æºã€‚", pool: ["turn on", "open", "First,", "switch off", "the", "main power.", "connect"] },
        { img: "lightswitch2.jpg", words: ["Next,", "remove", "the screws", "with", "a screwdriver."], correct: "Next, remove the screws with a screwdriver.", chi: "æ¥è‘—ï¼Œç”¨èºçµ²æ‰¹æ‹†é™¤èºçµ²ã€‚", pool: ["Next,", "remove", "the screws", "with", "a screwdriver.", "install", "fix", "pull", "cut"] },
        { img: "lightswitch3.jpg", words: ["Finally,", "remove", "the light switch", "from", "the wall."], correct: "Finally, remove the light switch from the wall.", chi: "æœ€å¾Œï¼Œå¾ç‰†ä¸Šæ‹†ä¸‹é›»ç‡ˆé–‹é—œã€‚", pool: ["Finally,", "remove", "the light switch", "from", "the wall.", "put", "paint", "clean"] }
    ];
    const l3Questions = [
        { q: "What should I do if the screwdriver is rusted?", a: "remove the rust", full: "You should remove the rust with sandpaper." },
        { q: "What should I do if the screwdriver bit doesn't fit?", a: "use another one", full: "You should use another one." },
        { q: "What should I do if the screws are bent?", a: "use new ones", full: "You should use new ones." },
        { q: "What should I do if the light switch is damaged?", a: "replace it", full: "You should replace it." }
    ];

    function startL(l) {
        currentL = l; currentStep = 0;
        document.getElementById('page-home').classList.remove('active');
        document.getElementById('page-practice').classList.add('active');
        render();
    }

    function goHome() { window.speechSynthesis.cancel(); document.getElementById('page-practice').classList.remove('active'); document.getElementById('page-home').classList.add('active'); }

    function render() {
        const m = document.getElementById('main-content');
        const ind = document.getElementById('level-indicator');
        if (currentL === 1) {
            ind.innerHTML = `Level 1<br>Sentence Building / å¥å­é‡çµ„`;
            const d = l1Data[currentStep]; m.innerHTML = `<p style="margin:0 0 5px 0; font-size:0.8rem;">Step ${currentStep+1}/3</p><div class="img-box"><img src="${d.img}"></div><div class="dropzone" id="dz">Tap to add / Tap words above to remove</div><div class="word-pool" id="pool"></div><button class="btn-action btn-record" onclick="checkL1()">Check / æª¢æŸ¥</button>`;
            const dz = document.getElementById('dz');
            const pool = document.getElementById('pool');
            [...d.pool].sort(() => Math.random() - 0.5).forEach(w => {
                const s = document.createElement('span'); s.className = 'word'; s.innerText = w.toLowerCase(); 
                if(w.includes(",")) s.innerText = w;
                s.onclick = () => { 
                    if(dz.innerText.includes("Tap to")) dz.innerText = "";
                    dz.appendChild(s); 
                    s.onclick = () => { // å†æ¬¡é»æ“Šä¸Šé¢çš„å­—æœƒå›åˆ°ä¸‹é¢ / Click word above to return below
                        pool.appendChild(s);
                        s.onclick = () => { if(dz.innerText.includes("Tap to")) dz.innerText = ""; dz.appendChild(s); s.onclick = arguments.callee; };
                        if(dz.children.length === 0) dz.innerText = "Tap words below / ä¾åºé»æ“Šå–®å­—...";
                    };
                };
                pool.appendChild(s);
            });
        } else if (currentL === 2) {
            ind.innerHTML = `Level 2<br>Listen & Repeat / è½èªªç·´ç¿’`;
            const d = l1Data[currentStep]; m.innerHTML = `<p style="margin:0 0 5px 0; font-size:0.8rem;">Step ${currentStep+1}/3</p><div class="img-box"><img src="${d.img}"></div><p style="font-weight:bold; color:var(--p1); text-align:center; font-size:0.95rem; margin:10px 0;">${d.correct}</p><button class="btn-action btn-listen" onclick="speak('${d.correct}')">ğŸ”Š Listen / è½ç¤ºç¯„</button><button class="btn-action btn-record" onclick="rec('${d.correct}', this)">ğŸ¤ Record / éŒ„éŸ³</button><button class="btn-action" style="background:#eee; color:#333;" onclick="nextStep()">Next / ä¸‹ä¸€æ­¥</button>`;
        } else if (currentL === 3) {
            ind.innerHTML = `Level 3<br>Troubleshooting / æ•…éšœæ’é™¤`;
            if (!currentQ) currentQ = l3Questions[Math.floor(Math.random() * l3Questions.length)];
            m.innerHTML = `<div class="img-box" style="background:var(--dark); cursor:pointer; height:100px;" onclick="speak(currentQ.q)"><div style="color:white; text-align:center; font-size:0.8rem;"><span style="font-size:1.5rem;">ğŸ§</span><br>Listen to customer / è½å–å•é¡Œ</div></div><div class="note-area"><strong>Troubleshooting:</strong><br>1. If screwdriver is rusted, remove rust with sandpaper.<br>2. If bit doesnâ€™t fit, use another one.<br>3. If screws are bent, use new ones.<br>4. If switch is damaged, replace it.</div><button class="btn-action btn-record" style="margin-top:0;" onclick="rec(currentQ.a, this, true)">ğŸ¤ Answer / å›ç­”å•é¡Œ</button><button class="btn-action" style="background:#eee; color:#333; padding:8px;" onclick="randomQ()">Next Question / éš¨æ©Ÿä¸‹ä¸€é¡Œ</button>`;
        }
    }

    function randomQ() { currentQ = l3Questions[Math.floor(Math.random() * l3Questions.length)]; render(); }

    function checkL1() {
        const d = l1Data[currentStep];
        const ans = Array.from(document.getElementById('dz').querySelectorAll('.word')).map(e => e.innerText).join(" ");
        if (ans.toLowerCase().replace(/ /g,'') === d.correct.toLowerCase().replace(/ /g,'')) {
            showPop("âœ… Correct! / æ­£ç¢ºï¼", "ğŸŒŸ", `<strong>${d.correct}</strong><br><br>${d.chi}`);
            currentStep++; if(currentStep > 2) { currentStep = 0; currentL = 2; }
            render();
        } else { showPop("âŒ Incorrect / ä¸æ­£ç¢º", "ğŸ˜•", "Please check your words or sequence.<br>è«‹æª¢æŸ¥å–®å­—é¸æ“‡æˆ–é †åºæ˜¯å¦æ­£ç¢ºã€‚"); }
    }

    function nextStep() { currentStep++; if(currentStep > 2) { currentStep = 0; startL(3); } else render(); }

    function speak(t) { window.speechSynthesis.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; m.rate = 0.85; window.speechSynthesis.speak(m); }

    const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
    const recognition = (SpeechRecognition) ? new SpeechRecognition() : null;
    if (recognition) { recognition.lang = 'en-US'; recognition.interimResults = false; }

    function rec(target, btn, isL3 = false) {
        if(!recognition) return;
        btn.innerText = "Listening..."; btn.classList.add('recording');
        recognition.start();
        recognition.onresult = (e) => {
            const res = e.results[0][0].transcript.toLowerCase();
            btn.innerText = "ğŸ¤ Record"; btn.classList.remove('recording');
            let cleanTarget = target.toLowerCase().replace(/[.,!]/g, '');
            let isCorrect = res.includes(cleanTarget) || cleanTarget.includes(res);
            const fb = isL3 ? 
                `<strong>Question / å•é¡Œ:</strong><br>"${currentQ.q}"<br><br><strong>You said / ä½ èªªäº†:</strong><br>"${res}"<br><br><strong>Answer / ç­”æ¡ˆ:</strong><br>"${currentQ.full}"` :
                `<strong>You said / ä½ èªªäº†:</strong><br>"${res}"<br><br><strong>Target / ç›®æ¨™:</strong><br>"${target}"`;
            showPop(isCorrect ? "âœ… Good Job! / åšå¾—å¥½ï¼" : "âŒ Keep Practicing / ç¹¼çºŒç·´ç¿’", isCorrect ? "ğŸ†" : "ğŸ’ª", fb);
        };
        recognition.onerror = () => { btn.innerText = "ğŸ¤ Record"; btn.classList.remove('recording'); };
    }

    function showPop(title, icon, text) {
        document.getElementById('pop-title').innerHTML = title;
        document.getElementById('pop-icon').innerText = icon;
        document.getElementById('pop-text').innerHTML = text;
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
    }
    function closePopup() { document.getElementById('overlay').style.display = 'none'; document.getElementById('popup').style.display = 'none'; }
</script>
</body>
</html>
