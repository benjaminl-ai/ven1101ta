<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEN1101 Assessment Prep</title>
    <style>
        :root { --p1: #4a90e2; --p2: #00b894; --p3: #f39c12; --bg: #f8f9fa; --dark: #2d3436; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--dark); }
        .header { text-align: center; margin-bottom: 20px; }
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { flex: 1; padding: 12px 5px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: #ddd; font-size: 0.85rem; }
        .nav button.active { color: white; }
        #n1.active { background: var(--p1); } #n2.active { background: var(--p2); } #n3.active { background: var(--p3); }

        .content { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 450px; }
        .img-box { width: 100%; height: 200px; background: #eee; border-radius: 15px; margin-bottom: 15px; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid #ddd; }
        .img-box img { width: 100%; height: 100%; object-fit: contain; }
        
        /* Level 1: Drag & Drop */
        .dropzone { border-bottom: 3px solid var(--p1); min-height: 50px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; background: #f0f7ff; border-radius: 10px 10px 0 0; }
        .word-pool { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background: #fff; border: 1px dashed #ccc; border-radius: 10px; }
        .word { padding: 10px 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; user-select: none; font-size: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .word:active { transform: scale(0.95); }
        
        /* Voice buttons */
        .btn-voice { width: 100%; padding: 15px; border: none; border-radius: 12px; margin-top: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; }
        .btn-listen { background: #eef2ff; color: var(--p1); }
        .btn-record { background: var(--p1); color: white; }
        .recording { background: #d63031 !important; animation: pulse 1.5s infinite; }
        
        .trouble-note { background: #fff9db; padding: 15px; border-radius: 10px; border-left: 5px solid var(--p3); font-size: 0.9rem; margin-bottom: 15px; line-height: 1.5; }
        .feedback { margin-top: 20px; padding: 15px; border-radius: 12px; font-size: 0.95rem; display: none; background: #f1f2f6; border: 1px solid #dfe4ea; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0;">VEN1101 Assessment Prep</h2>
    <p style="font-size:0.9rem; color: #666;">Step-by-Step Training ğŸ› ï¸</p>
</div>

<div class="nav">
    <button id="n1" class="active" onclick="setL(1)">Level 1<br>Sentence</button>
    <button id="n2" onclick="setL(2)">Level 2<br>Speaking</button>
    <button id="n3" onclick="setL(3)">Level 3<br>Listening</button>
</div>

<div id="main" class="content"></div>

<script>
    let level = 1, step = 0, userWords = [];
    
    // åœ–ç‰‡åç¨±å·²æ›´æ–° / Image names updated
    const l1Data = [
        { img: "lightswitch1.jpg", words: ["First,", "switch off", "the", "main power."], correct: "First, switch off the main power." },
        { img: "lightswitch2.jpg", words: ["Next,", "remove", "the screws", "with", "a screwdriver."], correct: "Next, remove the screws with a screwdriver." },
        { img: "lightswitch3.jpg", words: ["Finally,", "remove", "the light switch", "from", "the wall."], correct: "Finally, remove the light switch from the wall." }
    ];

    function setL(l) { 
        level = l; step = 0; 
        document.querySelectorAll('.nav button').forEach((b, i) => b.classList.toggle('active', i+1 === l));
        render(); 
    }

    function render() {
        const m = document.getElementById('main');
        if (level === 1) {
            const d = l1Data[step];
            userWords = [];
            m.innerHTML = `<h3>Level 1: Build Step ${step+1}</h3>
            <div class="img-box"><img src="${d.img}" alt="Step ${step+1}"></div>
            <div class="dropzone" id="dz">Click words below to build sentence...</div>
            <div class="word-pool" id="pool"></div>
            <button class="btn-voice btn-record" onclick="checkL1()" style="margin-top:20px">Check Answer / æª¢æŸ¥</button>
            <button onclick="render()" style="margin-top:10px; background:none; border:none; color:var(--p1); cursor:pointer;">Reset / é‡æ”¾</button>`;
            
            const pool = document.getElementById('pool');
            const dz = document.getElementById('dz');
            [...d.words].sort(() => Math.random() - 0.5).forEach(w => {
                const s = document.createElement('span'); s.className = 'word'; s.innerText = w;
                s.onclick = () => { 
                    if(dz.innerText.includes("Click words")) dz.innerText = "";
                    dz.appendChild(s); 
                };
                pool.appendChild(s);
            });
        } else if (level === 2) {
            const d = l1Data[step];
            m.innerHTML = `<h3>Level 2: Listen & Repeat</h3>
            <div class="img-box"><img src="${d.img}" alt="Step ${step+1}"></div>
            <p style="font-weight:bold; font-size:1.1rem; text-align:center; color:var(--p1);">${d.correct}</p>
            <button class="btn-voice btn-listen" onclick="speak('${d.correct}')">ğŸ”Š Listen / è½ç¤ºç¯„</button>
            <button class="btn-voice btn-record" onclick="rec('${d.correct}', this)">ğŸ¤ Record / éŒ„éŸ³ç·´ç¿’</button>
            <div id="fb" class="feedback"></div>
            <button class="btn-voice" onclick="nextStep()" style="background:#eee; color:#333; margin-top:20px">Next Step / ä¸‹ä¸€æ­¥</button>`;
        } else if (level === 3) {
            m.innerHTML = `<h3>Level 3: Listening Challenge</h3>
            <div class="img-box" style="background:#2d3436; flex-direction:column; color:white;">
                <span style="font-size:3rem;">ğŸ§</span>
                <span>Listen carefully to the question</span>
            </div>
            <div class="trouble-note">
                <strong>Trouble-shooting Note:</strong><br>
                1. If screwdriver is rusted, remove rust with sandpaper.<br>
                2. If bit doesn't fit, <b>use another one</b>.<br>
                3. If screws are bent, use new ones.<br>
                4. If light switch is damaged, replace it.
            </div>
            <button class="btn-voice btn-listen" style="background:var(--p3); color:white" onclick="speak('What should I do if the screwdriver bit doesn\'t fit?')">ğŸ‘‚ Listen to Customer / è½å•é¡Œ</button>
            <button class="btn-voice btn-record" onclick="rec('use another one', this, true)">ğŸ¤ Speak Your Answer / å›ç­”å•é¡Œ</button>
            <div id="fb" class="feedback"></div>`;
        }
    }

    function checkL1() {
        const ans = Array.from(document.getElementById('dz').querySelectorAll('.word')).map(e => e.innerText).join(" ");
        if (ans === l1Data[step].correct) {
            alert("Correct! âœ… Moving to next step."); step++; 
            if(step > 2) { step = 0; setL(2); } else render();
        } else { alert("Try again! âŒ Order is incorrect."); render(); }
    }

    function nextStep() { 
        step++; 
        if(step > 2) { alert("Level 2 Complete! Moving to Level 3."); setL(3); } 
        else render(); 
    }

    function speak(t) { 
        const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; m.rate = 0.85;
        window.speechSynthesis.speak(m); 
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition(); 
    recognition.lang = 'en-US'; 
    recognition.interimResults = false;

    function rec(target, btn, isL3 = false) {
        btn.innerText = "Listening... ğŸ‘‚"; btn.classList.add('recording');
        recognition.start();
        
        recognition.onresult = (e) => {
            const result = e.results[0][0].transcript.toLowerCase();
            const fb = document.getElementById('fb');
            btn.innerText = isL3 ? "ğŸ¤ Speak Your Answer" : "ğŸ¤ Record"; 
            btn.classList.remove('recording');
            fb.style.display = 'block';
            
            let isCorrect = result.includes(target.toLowerCase());
            if (isL3) {
                fb.innerHTML = `
                    <p><strong>Customer Question:</strong> "What should I do if the bit doesn't fit?"</p>
                    <p><strong>You said:</strong> <span style="color:blue">"${result}"</span></p>
                    <p><strong>Recommended Answer:</strong> "You should use another one."</p>
                    <hr>
                    ${isCorrect ? '<b style="color:green">âœ… Well done! You identified the correct solution.</b>' : '<b style="color:red">âŒ Try to include the phrase "use another one".</b>'}
                `;
            } else {
                fb.innerHTML = `
                    <p><strong>Your Voice:</strong> "${result}"</p>
                    <p><strong>Target:</strong> "${target}"</p>
                    ${isCorrect ? '<b style="color:green">âœ… Great! Pronunciation is clear.</b>' : '<b style="color:red">âŒ Keep trying! Try to speak more clearly.</b>'}
                `;
            }
        };
        
        recognition.onerror = () => {
            btn.innerText = "ğŸ¤ Record";
            btn.classList.remove('recording');
            alert("Could not hear you. Please try again!");
        };
    }

    // Start App
    render();
</script>
</body>
</html>
