<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEN1101 Assessment Prep</title>
    <style>
        :root { --p1: #4a90e2; --p2: #00b894; --p3: #f39c12; --bg: #f8f9fa; --dark: #2d3436; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--dark); }
        .header { text-align: center; margin-bottom: 20px; }
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { flex: 1; padding: 12px 5px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: #ddd; font-size: 0.85rem; }
        .nav button.active { color: white; }
        #n1.active { background: var(--p1); } #n2.active { background: var(--p2); } #n3.active { background: var(--p3); }

        .content { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 400px; }
        .img-box { width: 100%; height: 120px; background: #eee; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #888; border: 2px dashed #ccc; }
        
        /* Level 1: Drag & Drop */
        .dropzone { border-bottom: 2px solid var(--p1); min-height: 40px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 5px; padding: 5px; }
        .word-pool { display: flex; flex-wrap: wrap; gap: 8px; }
        .word { padding: 8px 12px; background: #e9ecef; border-radius: 5px; cursor: pointer; user-select: none; font-size: 0.9rem; }
        
        /* Level 2 & 3: Voice */
        .btn-voice { width: 100%; padding: 15px; border: none; border-radius: 12px; margin-top: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-listen { background: #eef2ff; color: var(--p1); }
        .btn-record { background: var(--p1); color: white; }
        .recording { background: #d63031 !important; animation: pulse 1.5s infinite; }
        
        .trouble-note { background: #fff9db; padding: 15px; border-radius: 10px; border-left: 5px solid var(--p3); font-size: 0.85rem; margin-bottom: 15px; }
        .feedback { margin-top: 15px; padding: 10px; border-radius: 10px; font-size: 0.9rem; display: none; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0;">VEN1101 Assessment Prep</h2>
    <p style="font-size:0.8rem; color: #666;">Instruction & Trouble-shooting ğŸ› ï¸</p>
</div>

<div class="nav">
    <button id="n1" class="active" onclick="setL(1)">Level 1<br>Sentence</button>
    <button id="n2" onclick="setL(2)">Level 2<br>Speaking</button>
    <button id="n3" onclick="setL(3)">Level 3<br>Listening</button>
</div>

<div id="main" class="content"></div>

<script>
    let level = 1, step = 0, userWords = [];
    const l1Data = [
        { img: "", words: ["First,", "switch off", "the", "main power."], correct: "First, switch off the main power." },
        { img: "", words: ["Next,", "remove", "the screws", "with", "a screwdriver."], correct: "Next, remove the screws with a screwdriver." },
        { img: "", words: ["Finally,", "remove", "the light switch", "from", "the wall."], correct: "Finally, remove the light switch from the wall." }
    ];

    function setL(l) { 
        level = l; step = 0; 
        document.querySelectorAll('.nav button').forEach((b, i) => b.classList.toggle('active', i+1 === l));
        render(); 
    }

    function render() {
        const m = document.getElementById('main');
        if (level === 1) {
            const d = l1Data[step];
            m.innerHTML = `<h3>Step ${step+1} / 3</h3><div class="img-box">${d.img}</div><div class="dropzone" id="dz"></div><div class="word-pool" id="pool"></div>
            <button class="btn-voice btn-record" onclick="checkL1()" style="margin-top:20px">Check / æª¢æŸ¥</button>`;
            const pool = document.getElementById('pool');
            [...d.words].sort(() => Math.random() - 0.5).forEach(w => {
                const s = document.createElement('span'); s.className = 'word'; s.innerText = w;
                s.onclick = () => { document.getElementById('dz').appendChild(s); userWords.push(w); };
                pool.appendChild(s);
            });
        } else if (level === 2) {
            const d = l1Data[step];
            m.innerHTML = `<h3>Step ${step+1} / 3</h3><div class="img-box">${d.img}</div>
            <p style="font-weight:bold">${d.correct}</p>
            <button class="btn-voice btn-listen" onclick="speak('${d.correct}')">ğŸ”Š Listen / è½ç¤ºç¯„</button>
            <button class="btn-voice btn-record" onclick="rec('${d.correct}', this)">ğŸ¤ Record / éŒ„éŸ³ç·´ç¿’</button>
            <div id="fb" class="feedback"></div>
            <button class="btn-voice" onclick="nextStep()" style="background:#eee; color:#333; margin-top:20px">Next Step / ä¸‹ä¸€æ­¥</button>`;
        } else if (level === 3) {
            m.innerHTML = `<h3>Final Challenge / è½åŠ›æŒ‘æˆ°</h3>
            <div class="img-box" style="background:#2d3436; color:white;">ğŸ§ Listen to the question...</div>
            <div class="trouble-note">
                <strong>Trouble-shooting Note:</strong><br>
                1. Rusted screwdriver: Use sandpaper.<br>
                2. Bit doesn't fit: Use another one.<br>
                3. Bent screws: Use new ones.<br>
                4. Damaged switch: Replace it.
            </div>
            <button class="btn-voice btn-listen" style="background:var(--p3); color:white" onclick="speak('What should I do if the screwdriver bit doesn\'t fit?')">ğŸ‘‚ Listen to Customer</button>
            <button class="btn-voice btn-record" onclick="rec('use another one', this, true)">ğŸ¤ Your Answer / ä½ çš„å›ç­”</button>
            <div id="fb" class="feedback"></div>`;
        }
    }

    function checkL1() {
        const ans = Array.from(document.getElementById('dz').children).map(e => e.innerText).join(" ");
        if (ans === l1Data[step].correct) {
            alert("Correct! âœ…"); step++; if(step > 2) { step = 0; setL(2); } else render();
        } else { alert("Try again! âŒ"); render(); }
    }

    function nextStep() { step++; if(step > 2) step = 0; render(); }

    function speak(t) { 
        const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; m.rate = 0.9;
        window.speechSynthesis.speak(m); 
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition(); recognition.lang = 'en-US';

    function rec(target, btn, isL3 = false) {
        btn.innerText = "Listening..."; btn.classList.add('recording');
        recognition.start();
        recognition.onresult = (e) => {
            const result = e.results[0][0].transcript.toLowerCase();
            const fb = document.getElementById('fb');
            btn.innerText = "ğŸ¤ Record"; btn.classList.remove('recording');
            fb.style.display = 'block';
            
            let isCorrect = result.includes(target.toLowerCase()) || target.toLowerCase().includes(result);
            if (isL3) {
                fb.innerHTML = `<strong>Question:</strong> "What should I do if the bit doesn't fit?"<br>
                <strong>You said:</strong> "${result}"<br>
                <strong>Correct:</strong> "You should use another one."<br>
                ${isCorrect ? '<span style="color:green">âœ… Great Response!</span>' : '<span style="color:red">âŒ Try to mention "use another one"</span>'}`;
            } else {
                fb.innerHTML = `<strong>Feedback:</strong><br>You said: "${result}"<br>${isCorrect ? '<span style="color:green">âœ… Perfect Pronunciation!</span>' : '<span style="color:red">âŒ Keep practicing!</span>'}`;
            }
        };
    }
</script>
</body>
</html>
