<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BSE Challengers</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Noto+Sans+TC:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --arc-red: #ff1111; --arc-yellow: #f8e71c; --arc-blue: #0044cc; }
        body { 
            font-family: 'Oswald', 'Noto Sans TC', sans-serif; background: #111; 
            margin: 0; padding: 0; color: #fff; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* å¼·åˆ¶é–ƒçˆ Class */
        .active-flash { background: var(--arc-red) !important; color: #fff !important; transform: scale(0.92) !important; }

        .page { display: none; height: 100dvh; padding: 15px; flex-direction: column; box-sizing: border-box; }
        .page.active { display: flex; }

        .arcade-header { display: flex; align-items: center; justify-content: space-between; padding: 8px; background: #000; border-bottom: 3px solid var(--arc-yellow); margin-bottom: 10px; }
        .hp-bar { height: 14px; width: 100px; background: #333; border: 2px solid #fff; }
        .hp-fill { height: 100%; width: 100%; background: #00ff00; transition: 0.4s; }

        .btn-box { background: linear-gradient(to right, #222, #000); border: 3px solid #fff; padding: 12px; margin-bottom: 12px; cursor: pointer; display: flex; align-items: center; gap: 15px; }
        .btn-box span { color: var(--arc-yellow); font-size: 13px; display: block; margin-top: 4px; }
        
        .chip { background: var(--arc-yellow); color: #000; padding: 6px 10px; font-weight: bold; font-size: 13px; border: 1px solid #000; cursor: pointer; margin: 2px; display: inline-block; }
        .arc-btn { border: 2px solid #fff; color: #fff; padding: 10px; font-weight: bold; text-align: center; cursor: pointer; }
        .arc-btn.red { background: #990000; }
        .arc-btn.blue { background: var(--arc-blue); }
        .arc-btn.grey { background: #555; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; }
        .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; background: #fff; color: #000; border: 5px solid var(--arc-yellow); padding: 15px; z-index: 101; text-align: center; }
        .popup h2 { margin: 0; font-size: 32px; font-style: italic; color: var(--arc-red); -webkit-text-stroke: 1px #000; }
        .popup .chi-sub { display: block; font-size: 14px; margin-top: 8px; color: #444; font-weight: bold; }
        .pop-btn-small { background: var(--arc-red); color: #fff; padding: 8px 15px; border: 2px solid #000; font-weight: bold; display: inline-block; margin-top: 15px; cursor: pointer; }

        .img-screen { width: 100%; height: 120px; border: 3px solid #fff; background: #222; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; }
        .img-screen img { max-width: 100%; max-height: 100%; }
        .drop-zone { min-height: 40px; border: 2px dashed #777; padding: 5px; background: rgba(0,0,0,0.7); margin-bottom: 8px; }
    </style>
</head>
<body>

<div id="page-home" class="page active">
    <div style="text-align:center; padding-top: 35px;">
        <h2 style="font-size: 19px; color:var(--arc-yellow); margin:0;">
            ğŸ¥Š BSE STUDENTS <span style="color:var(--arc-red);">VS</span> VEN1101 TA ğŸ§¤
        </h2>
        <div style="margin-top: 25px; padding: 5px 15px; background: #fff; color: #000; display: inline-block; font-weight: bold; font-size: 14px; border: 2px solid var(--arc-red);">
            BSE CHALLENGE | å±‹å®‡è£å‚™å·¥ç¨‹
        </div>
    </div>
    <div style="margin-top: 45px;">
        <div class="btn-box flash-trigger" onclick="selectTask(1)">
            <div style="font-size: 28px;">ğŸ¥Š</div>
            <div class="btn-text">STRIKE 1: Removing a light switch<span>ç¬¬ä¸€éšæ®µï¼šæ‹†å¸é›»ç‡ˆé–‹é—œ</span></div>
        </div>
        <div class="btn-box flash-trigger" onclick="selectTask(2)">
            <div style="font-size: 28px;">ğŸ¥Š</div>
            <div class="btn-text">STRIKE 2: Drilling holes on a steel box<span>ç¬¬äºŒéšæ®µï¼šåœ¨é‹¼ç®±é‘½å­”</span></div>
        </div>
    </div>
</div>

<div id="page-levels" class="page">
    <div class="arc-btn grey flash-trigger" style="width:fit-content; padding: 5px 10px; font-size:12px;" onclick="backToHome()">â¬… HOME</div>
    <h2 style="text-align:center; color: var(--arc-yellow);">SELECT ROUND</h2>
    <div class="btn-box flash-trigger" onclick="startL(1)">ğŸ¥Š <div class="btn-text">ROUND 1: BUILDING<span>çµ„å¥ç·´ç¿’</span></div></div>
    <div class="btn-box flash-trigger" onclick="startL(2)">ğŸ¥Š <div class="btn-text">ROUND 2: SPEAKING<span>è½èªªç·´ç¿’</span></div></div>
    <div class="btn-box flash-trigger" onclick="startL(3)">ğŸ¥Š <div class="btn-text">ROUND 3: TROUBLESHOOTING<span>ç–‘é›£æ’è§£</span></div></div>
</div>

<div id="page-practice" class="page">
    <div class="arcade-header">
        <div><div class="hp-bar"><div id="hp-player" class="hp-fill"></div></div></div>
        <div style="color:var(--arc-red); font-weight:900;">VS</div>
        <div><div class="hp-bar"><div id="hp-enemy" class="hp-fill" style="background:var(--arc-red);"></div></div></div>
    </div>
    <div id="main-content" style="flex-grow:1; display:flex; flex-direction:column;"></div>
    <div class="arc-btn grey flash-trigger" style="margin-top:10px; font-size:12px;" onclick="backToLevels()">â¬… BACK</div>
</div>

<div class="overlay" id="overlay"></div>
<div id="popup" class="popup">
    <h2 id="pop-title">VICTORY!</h2>
    <div id="pop-text"></div>
    <div id="pop-btn" class="pop-btn-small flash-trigger" onclick="closePopup()">CONTINUE / ç¹¼çºŒ</div>
</div>

<script>
    let currentTask = 1, currentL = 1, currentStep = 0, qCount = 0;
    let isMicOn = false, shouldAutoNext = false, isGameOver = false;

    const tasksData = {
        1: {
            steps: [
                { img: "lightswitch1.jpg", correct: "First, switch off the main power.", chi: "é¦–å…ˆï¼Œé—œæ‰ç¸½é›»æºã€‚", pool: ["First,", "switch off", "the", "main power.", "disconnect", "unscrew"] },
                { img: "lightswitch2.jpg", correct: "Next, remove the screws with a screwdriver.", chi: "æ¥è‘—ï¼Œç”¨èºçµ²æ‰¹æ‹†é™¤èºçµ²ã€‚", pool: ["Next,", "remove", "the screws", "with", "a screwdriver.", "pull"] },
                { img: "lightswitch3.jpg", correct: "Finally, remove the light switch from the wall.", chi: "æœ€å¾Œï¼Œå¾ç‰†ä¸Šæ‹†ä¸‹é›»ç‡ˆé–‹é—œã€‚", pool: ["Finally,", "remove", "the light switch", "from", "the wall.", "fix"] }
            ],
            trouble: [
                { q: "What should I do if the screwdriver is rusted?", a: "remove the rust", chi: "å¦‚æœèºçµ²æ‰¹ç”Ÿé½äº†ï¼Œç”¨ç ‚ç´™é™¤é½ã€‚" },
                { q: "What should I do if the screwdriver bit doesn't fit?", a: "use another one", chi: "å¦‚æœæ‰¹é ­ä¸åˆé©ï¼Œæ›å¦ä¸€å€‹ä½¿ç”¨ã€‚" }
            ],
            ts_note: "1. If rusted, remove rust.<br>2. If not fit, use another one."
        },
        2: {
            steps: [
                { img: "drill1.jpg", correct: "First, measure the steel box with a tape measure.", chi: "é¦–å…ˆï¼Œç”¨æ²å°ºæ¸¬é‡é‹¼ç®±ã€‚", pool: ["First,", "measure", "the box", "with", "tape measure.", "mark"] },
                { img: "drill2.jpg", correct: "Next, mark the spots with a marker.", chi: "æ¥è‘—ï¼Œç”¨æ¨™è¨˜ç­†æ¨™è¨˜ä½ç½®ã€‚", pool: ["Next,", "mark", "the spots", "with", "a marker.", "drill"] },
                { img: "drill3.jpg", correct: "Finally, drill holes with a power drill.", chi: "æœ€å¾Œï¼Œç”¨é›»é‘½é‘½å­”ã€‚", pool: ["Finally,", "drill", "holes", "with", "a power drill.", "screw"] }
            ],
            trouble: [
                { q: "What should I do if the drill bit is broken?", a: "replace it", chi: "å¦‚æœé‘½é ­æ–·äº†ï¼Œæ›´æ›å®ƒã€‚" },
                { q: "What should I do if the power drill doesn't work?", a: "check the battery", chi: "å¦‚æœé›»é‘½ç„¡æ³•é‹ä½œï¼Œæª¢æŸ¥é›»æ± ã€‚" }
            ],
            ts_note: "1. If broken, replace it.<br>2. If no power, check battery."
        }
    };

    // ğŸ”´ ä¿®æ­£é–ƒçˆï¼šç”¨ JS ç›£è½æ‰€æœ‰é»æ“Š
    document.addEventListener('mousedown', handleFlash);
    document.addEventListener('touchstart', handleFlash);

    function handleFlash(e) {
        const el = e.target.closest('.flash-trigger, .chip, .arc-btn, .btn-box');
        if (el) {
            el.classList.add('active-flash');
            setTimeout(() => el.classList.remove('active-flash'), 150);
        }
    }

    function selectTask(tid) { currentTask = tid; showPage('page-levels'); }
    function backToHome() { showPage('page-home'); }
    function backToLevels() { showPage('page-levels'); }
    function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }

    function startL(l) { currentL = l; currentStep = 0; qCount = 0; isGameOver = false; showPage('page-practice'); render(); }

    function render() {
        const m = document.getElementById('main-content');
        const data = tasksData[currentTask];
        updateHP();

        if (currentL === 1) {
            const d = data.steps[currentStep];
            m.innerHTML = `<div class="img-screen"><img src="${d.img}"></div><div class="drop-zone" id="dz"></div><div id="pool"></div><div class="action-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:auto;">
                <div class="arc-btn blue" onclick="showPop('HINT', '${d.chi}', false)">HINT</div>
                <div class="arc-btn red" onclick="checkL1()">CHECK</div>
            </div>`;
            const pool = document.getElementById('pool');
            [...d.pool, ...d.correct.split(' ')].filter((v, i, a) => a.indexOf(v) === i).sort(()=>Math.random()-0.5).forEach(w => {
                const s = document.createElement('span'); s.className = 'chip'; s.innerText = w;
                s.onclick = () => { (s.parentNode === pool ? document.getElementById('dz') : pool).appendChild(s); };
                pool.appendChild(s);
            });
        } else if (currentL === 2) {
            const d = data.steps[currentStep];
            m.innerHTML = `<div class="img-screen"><img src="${d.img}"></div><div style="background:#fff; color:#000; padding:10px; font-weight:bold; border:3px solid var(--arc-yellow);"><p style="color:var(--arc-red); margin:0;">${d.correct}</p><p style="margin:5px 0 0 0; font-size:13px;">${d.chi}</p></div>
            <div style="margin-top:auto;"><div class="arc-btn blue" onclick="speak('${d.correct}')">ğŸ”Š LISTEN</div><div class="arc-btn red" style="margin-top:8px;" onclick="rec('${d.correct}')">ğŸ¤ SPEAK</div><div class="arc-btn grey" style="margin-top:8px;" onclick="nextQ()">SKIP</div></div>`;
        } else if (currentL === 3) {
            const q = data.trouble[qCount];
            m.innerHTML = `<div class="arc-btn blue" onclick="speak('${q.q}')">ğŸ”Š CLIENT: ${q.q}</div><div style="background:#000; border:2px solid #fff; padding:10px; font-size:12px; margin:10px 0; flex-grow:1;">${data.ts_note}</div>
            <div style="margin-top:auto;"><div class="arc-btn red" onclick="rec('${q.a}')">ğŸ¤ ANSWER</div><div class="arc-btn grey" style="margin-top:8px;" onclick="nextQ()">SKIP</div></div>`;
        }
    }

    function updateHP() {
        let eHP = 100 - (currentL === 3 ? (qCount / tasksData[currentTask].trouble.length * 100) : (currentStep / 3 * 100));
        document.getElementById('hp-enemy').style.width = eHP + "%";
    }

    function showPop(title, mainText, success) {
        document.getElementById('pop-title').innerText = title;
        document.getElementById('pop-title').style.color = success ? "green" : "red";
        
        let chiLine = "";
        if (title === "HINT") chiLine = "é€™æ˜¯çµ¦ä½ çš„æç¤ºï¼";
        else if (title === "VICTORY!") chiLine = "åšå¾—å¥½ï¼ä½ å·²ç¶“å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼";
        else if (success) chiLine = "åšå¾—å¥½ï¼ç¹¼çºŒä¸‹ä¸€é—œï¼";
        else chiLine = (currentL === 1 ? "é †åºå””å•±ï¼Œå†è©¦å“ï¼" : "ç™¼éŸ³å””æº–ï¼Œå†è©¦å“ï¼");

        document.getElementById('pop-text').innerHTML = `${mainText}<span class="chi-sub">${chiLine}</span>`;
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
        shouldAutoNext = success;
    }

    function closePopup() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('popup').style.display = 'none';
        if (isGameOver) backToHome();
        else if (shouldAutoNext) nextQ();
    }

    function checkL1() {
        const d = tasksData[currentTask].steps[currentStep];
        const ans = Array.from(document.getElementById('dz').querySelectorAll('.chip')).map(e => e.innerText).join(" ").replace(/ ,/g, ',');
        if (ans.toLowerCase().trim() === d.correct.toLowerCase().trim()) showPop("PERFECT!", d.correct, true);
        else showPop("MISS!", "Try again!", false);
    }

    function nextQ() {
        if (currentL === 1) { currentStep++; if (currentStep > 2) { currentStep = 0; currentL = 2; } }
        else if (currentL === 2) { currentStep++; if (currentStep > 2) { currentStep = 0; currentL = 3; } }
        else if (currentL === 3) { 
            qCount++; 
            if (qCount >= tasksData[currentTask].trouble.length) { 
                isGameOver = true;
                showPop("VICTORY!", "ALL ROUNDS COMPLETED!", true); 
                return; 
            } 
        }
        render();
    }

    function speak(t) { window.speechSynthesis.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; window.speechSynthesis.speak(m); }
    
    function rec(target) {
        const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!SpeechRecognition) return alert("Speech not supported");
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.start();
        recognition.onresult = (e) => {
            const res = e.results[0][0].transcript.toLowerCase();
            if (res.includes(target.toLowerCase().split(' ')[0])) showPop("K.O.!", "Great!", true);
            else showPop("TRY AGAIN", `You said: ${res}`, false);
        };
    }
</script>
</body>
</html>
