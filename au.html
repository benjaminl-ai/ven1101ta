<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AU Challengers - Automotive</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Noto+Sans+TC:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --arc-red: #ff1111; --arc-yellow: #f8e71c; --arc-blue: #0044cc; --arc-dark: #000;
        }
        body { 
            font-family: 'Oswald', 'Noto Sans TC', sans-serif; background: #111; 
            margin: 0; padding: 0; color: #fff; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .shake { animation: shake 0.3s; }
        @keyframes shake { 
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-4px, 4px); }
            50% { transform: translate(4px, -4px); }
            75% { transform: translate(-4px, -4px); }
        }

        .flash-active { 
            background-color: var(--arc-red) !important; 
            color: #fff !important;
            transform: scale(0.94);
        }

        .page { display: none; height: 100dvh; padding: 15px; flex-direction: column; box-sizing: border-box; }
        .page.active { display: flex; }

        .arcade-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px; background: #000; border-bottom: 3px solid var(--arc-yellow); margin-bottom: 10px;
        }
        .hp-bar { height: 14px; width: 100px; background: #333; border: 2px solid #fff; }
        .hp-fill { height: 100%; width: 100%; background: #00ff00; transition: 0.4s; }

        .btn-small { background: #444; border: 2px solid #fff; color: #fff; padding: 4px 10px; font-size: 11px; cursor: pointer; width: fit-content; text-decoration: none; }

        .btn-box {
            background: linear-gradient(to right, #222, #000); border: 3px solid #fff;
            padding: 12px; margin-bottom: 12px; cursor: pointer; display: flex; align-items: center; gap: 15px;
        }
        .btn-box .btn-text { flex-grow: 1; }
        .btn-box span { color: var(--arc-yellow); font-size: 13px; display: block; margin-top: 4px; }

        .img-screen { width: 100%; height: 180px; border: 3px solid #fff; background: #222; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; }
        .img-screen img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .drop-zone { min-height: 45px; border: 2px dashed #777; padding: 8px; display: flex; flex-wrap: wrap; gap: 5px; background: rgba(0,0,0,0.7); margin-bottom: 8px; }
        .chip { background: var(--arc-yellow); color: #000; padding: 6px 10px; font-weight: bold; font-size: 13px; border: 1px solid #000; cursor: pointer; }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .arc-btn { border: 2px solid #fff; color: #fff; padding: 10px; font-weight: bold; text-align: center; cursor: pointer; font-size: 14px; transition: background 0.1s; }
        .arc-btn.red { background: #990000; }
        .arc-btn.blue { background: var(--arc-blue); }
        .arc-btn.grey { background: #555; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; }
        .popup { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 80%; background: #fff; color: #000; border: 5px solid var(--arc-yellow); padding: 15px; z-index: 101; text-align: center;
        }
        .popup h2 { margin: 0; font-size: 32px; font-style: italic; color: var(--arc-red); -webkit-text-stroke: 1px #000; }
        .popup .chi-sub { display: block; font-size: 14px; margin-top: 8px; color: #444; font-weight: bold; }
        .pop-btn-small { background: var(--arc-red); color: #fff; padding: 8px 15px; border: 2px solid #000; font-weight: bold; display: inline-block; margin-top: 15px; cursor: pointer; font-size: 13px; }

        #flash { position: fixed; top:0; left:0; width:100%; height:100%; background: #fff; display:none; z-index: 1000; opacity: 0.7; pointer-events: none; }
    </style>
</head>
<body id="game-body">

<div id="flash"></div>

<div id="page-home" class="page active">
    <div style="text-align:center; padding-top: 25px;">
        <h2 style="font-size: 19px; color:var(--arc-yellow); margin:0; letter-spacing: 0.5px;">
            ğŸ¥Š AU STUDENTS <span style="color:var(--arc-red); font-style:italic;">VS</span> VEN1101 TA ğŸ¥Š
        </h2>
        <div style="margin-top: 20px; padding: 5px 15px; background: #fff; color: #000; display: inline-block; font-weight: bold; font-size: 14px; border: 2px solid var(--arc-red);">
            AU CHALLENGE | æ±½è»Šå·¥ç¨‹
        </div>
    </div>
    <div style="margin-top: 35px;">
        <div class="btn-box" onclick="selectTask(1)">
            <div style="font-size: 28px;">ğŸ¥Š</div>
            <div class="btn-text">STRIKE 1: Measuring brake pads<span>ç¬¬ä¸€éšæ®µï¼šé‡åº¦ç…è»Šçš®</span></div>
        </div>
        <div class="btn-box" onclick="selectTask(2)">
            <div style="font-size: 28px;">ğŸ¥Š</div>
            <div class="btn-text">STRIKE 2: Getting an oil dipstick<span>ç¬¬äºŒéšæ®µï¼šå–å‡ºæ©Ÿæ²¹å°º</span></div>
        </div>
    </div>

    <footer style="text-align: center; margin-top: auto; padding-bottom: 20px;">
        <a href="index.html" class="footer-back-btn">â¬… BACK TO PORTAL / è¿”å›ç¸½ç›®éŒ„</a>
    </footer>
</div>

<div id="page-levels" class="page">
    <div class="btn-small" onclick="backToHome()">â¬… HOME</div>
    <h2 style="text-align:center; color: var(--arc-yellow);">SELECT ROUND</h2>
    <div class="btn-box" onclick="startL(1)">
        <div style="font-size: 20px;">ğŸ¥Š</div>
        <div class="btn-text">ROUND 1: BUILDING<span>çµ„å¥ç·´ç¿’</span></div>
    </div>
    <div class="btn-box" onclick="startL(2)">
        <div style="font-size: 20px;">ğŸ¥Š</div>
        <div class="btn-text">ROUND 2: SPEAKING<span>è½èªªç·´ç¿’</span></div>
    </div>
    <div class="btn-box" onclick="startL(3)">
        <div style="font-size: 20px;">ğŸ¥Š</div>
        <div class="btn-text">ROUND 3: TROUBLESHOOTING<span>ç–‘é›£æ’è§£</span></div>
    </div>
</div>

<div id="page-practice" class="page">
    <div class="arcade-header">
        <div><div style="font-size:9px;">AU CHALLENGER</div><div class="hp-bar"><div id="hp-player" class="hp-fill"></div></div></div>
        <div style="color:var(--arc-red); font-weight:900;">VS</div>
        <div><div style="font-size:9px; text-align:right;">VEN1101 TA</div><div class="hp-bar"><div id="hp-enemy" class="hp-fill" style="background:var(--arc-red);"></div></div></div>
    </div>
    <div id="main-content" class="stage-box" style="flex-grow:1;"></div>
    <div class="btn-small" style="margin-top:10px;" onclick="backToLevels()">â¬… BACK</div>
</div>

<div class="overlay" id="overlay"></div>
<div id="popup" class="popup">
    <h2 id="pop-title">K.O.</h2>
    <div id="pop-text" style="font-weight:bold; margin-top: 10px;"></div>
    <div id="pop-btn" class="pop-btn-small" onclick="closePopup()">CONTINUE / ç¹¼çºŒ</div>
</div>

<script>
    let currentTask = 1, currentL = 1, currentStep = 0, qCount = 0, currentQ = null, isMicOn = false, shouldAutoNext = false;
    let shuffledL3 = [];
    let isVictoryState = false;

    // Based on uploaded images
    const tasksData = {
        1: {
            steps: [
                { img: "brake1.jpg", correct: "First, remove the brake caliper.", chi: "é¦–å…ˆï¼Œç§»é–‹ç…è»Šé‰—ã€‚", pool: ["First,", "remove", "the", "brake caliper.", "tighten", "clean", "put"] },
                { img: "brake2.jpg", correct: "Next, take out the brake pad.", chi: "æ¥è‘—ï¼Œå–å‡ºç…è»Šçš®ã€‚", pool: ["Next,", "take out", "the", "brake pad.", "push", "adjust", "fix"] },
                { img: "brake3.jpg", correct: "Finally, measure the thickness of brake pad with vernier calipers.", chi: "æœ€å¾Œï¼Œç”¨æ¸¸æ¨™å¡å°ºé‡åº¦ç…è»Šçš®çš„åšåº¦ã€‚", pool: ["Finally,", "measure", "the thickness", "of brake pad", "with", "vernier calipers.", "clean", "apply"] }
            ],
            trouble: [
                { q: "What should I do if the jaws are too tight?", a: "add some WD-40", chi: "å¦‚æœå¤¾é‰—å¤ªç·Šï¼ŒåŠ å…¥ä¸€äº› WD-40ã€‚" },
                { q: "What should I do if the reading is wrong?", a: "repeat the steps", chi: "å¦‚æœè®€æ•¸éŒ¯èª¤ï¼Œé‡è¤‡æ­¥é©Ÿã€‚" },
                { q: "What should I do if the vernier caliper is faulty?", a: "use another one", chi: "å¦‚æœæ¸¸æ¨™å¡å°ºæœ‰æ•…éšœï¼Œä½¿ç”¨å¦ä¸€å€‹ã€‚" },
                { q: "What should I do if the brake pad is damaged?", a: "replace it", chi: "å¦‚æœç…è»Šçš®æå£ï¼Œæ›´æ›å®ƒã€‚" }
            ],
            ts_note: "1. If the jaws are too tight, add some WD-40.<br>2. If the reading is wrong, repeat the steps.<br>3. If the vernier caliper is faulty, use another one.<br>4. If the brake pad is damaged, replace it."
        },
        2: {
            steps: [
                { img: "oil1.jpg", correct: "First, open the car hood.", chi: "é¦–å…ˆï¼Œæ‰“é–‹è»Šé ­è“‹ã€‚", pool: ["First,", "open", "the", "car hood.", "close", "clean", "lock"] },
                { img: "oil2.jpg", correct: "Next, find the oil dipstick in the engine bay.", chi: "æ¥è‘—ï¼Œåœ¨å¼•æ“å®¤æ‰¾åˆ°æ©Ÿæ²¹å°ºã€‚", pool: ["Next,", "find", "the", "oil dipstick", "in the", "engine bay.", "pipe", "tray"] },
                { img: "oil3.jpg", correct: "Finally, pull the oil dipstick out of the pipe.", chi: "æœ€å¾Œï¼Œå°‡æ©Ÿæ²¹å°ºå¾ç®¡ä¸­æ‹”å‡ºã€‚", pool: ["Finally,", "pull", "the oil dipstick", "out of", "the pipe.", "push", "insert"] }
            ],
            trouble: [
                { q: "What should I do if the car hood is stuck?", a: "pull the lever again", chi: "å¦‚æœè»Šé ­è“‹å¡ä½ï¼Œå†æ¬¡æ‹‰å‹•æ‹‰æ¡¿ã€‚" },
                { q: "What should I do if the oil dipstick is dirty?", a: "wipe it with a cloth", chi: "å¦‚æœæ©Ÿæ²¹å°ºé«’äº†ï¼Œç”¨å¸ƒæ“¦æ‹­ã€‚" },
                { q: "What should I do if there is no oil?", a: "refill the oil", chi: "å¦‚æœæ²’æœ‰æ²¹ï¼Œé‡æ–°åŠ æ»¿æ©Ÿæ²¹ã€‚" },
                { q: "What should I do if the engine is too hot?", a: "wait for it to cool down", chi: "å¦‚æœå¼•æ“å¤ªç‡™ï¼Œç­‰å¾…å®ƒå†·å»ã€‚" }
            ],
            ts_note: "1. If the car hood is stuck, pull the lever again.<br>2. If the dipstick is dirty, wipe it with a cloth.<br>3. If no oil, refill the oil.<br>4. If the engine is hot, wait for it to cool down."
        }
    };

    // Voice Initialization Fix
    function initSpeech() {
        try {
            window.speechSynthesis.getVoices();
            const unlock = new SpeechSynthesisUtterance('');
            window.speechSynthesis.speak(unlock);
        } catch(e) {}
    }
    document.addEventListener('touchstart', initSpeech, { once: true });
    document.addEventListener('click', initSpeech, { once: true });

    function speak(t) {
        window.speechSynthesis.cancel(); 
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'en-US';
        m.rate = 0.9;
        setTimeout(() => { window.speechSynthesis.speak(m); }, 50);
    }

    ['mousedown', 'touchstart'].forEach(evtType => {
        document.addEventListener(evtType, (e) => {
            const el = e.target.closest('.btn-box, .arc-btn, .btn-small, .chip, .pop-btn-small');
            if (el) {
                el.classList.add('flash-active');
                setTimeout(() => el.classList.remove('flash-active'), 100);
            }
        });
    });

    function selectTask(tid) { currentTask = tid; document.getElementById('page-home').classList.remove('active'); document.getElementById('page-levels').classList.add('active'); }
    function backToHome() { document.getElementById('page-levels').classList.remove('active'); document.getElementById('page-home').classList.add('active'); }
    function backToLevels() { stopMic(); document.getElementById('page-practice').classList.remove('active'); document.getElementById('page-levels').classList.add('active'); }

    function startL(l) { 
        currentL = l; currentStep = 0; qCount = 0; isVictoryState = false;
        if (l === 3) shuffledL3 = [...tasksData[currentTask].trouble].sort(() => Math.random() - 0.5);
        document.getElementById('page-levels').classList.remove('active'); document.getElementById('page-practice').classList.add('active'); render(); 
    }

    function render() {
        const m = document.getElementById('main-content');
        const data = tasksData[currentTask];
        updateHP();

        if (currentL === 1) {
            const d = data.steps[currentStep];
            m.innerHTML = `<div class="img-screen"><img src="${d.img}"></div><div class="drop-zone" id="dz"></div><div class="drop-zone" id="pool" style="border:none; background:none;"></div><div class="action-grid"><div class="arc-btn blue" onclick="showPop('HINT', '${d.chi}', false)">HINT<br><small>æç¤º</small></div><div class="arc-btn red" onclick="checkL1()">CHALLENGE!<br><small>æª¢æŸ¥</small></div></div>`;
            const dz = document.getElementById('dz'), pool = document.getElementById('pool');
            [...d.pool].sort(() => Math.random() - 0.5).forEach(w => {
                const s = document.createElement('span'); s.className = 'chip'; s.innerText = w;
                s.onclick = () => { s.parentNode === pool ? dz.appendChild(s) : pool.appendChild(s); };
                pool.appendChild(s);
            });
        } else if (currentL === 2) {
            const d = data.steps[currentStep];
            m.innerHTML = `<div class="img-screen"><img src="${d.img}"></div><div style="background:#fff; color:#000; padding:12px; font-weight:bold; border:4px solid var(--arc-yellow);"><p style="color:var(--arc-red); margin:0;">${d.correct}</p><p style="margin:5px 0 0 0; font-size:14px;">${d.chi}</p></div><div class="action-grid" style="margin-top:10px;"><div class="arc-btn blue" onclick="speak('${d.correct}')">LISTEN<br><small>è½ç¤ºç¯„</small></div><div id="rec-btn" class="arc-btn red" onclick="rec('${d.correct}', this)">SPEAKING FIGHT!<br><small>é–‹å§‹æŒ‘æˆ°</small></div></div><div class="arc-btn grey" style="margin-top:8px;" onclick="nextQ()">SKIP ROUND / è·³é</div>`;
        } else if (currentL === 3) {
            currentQ = shuffledL3[qCount];
            m.innerHTML = `<div class="arc-btn blue" onclick="speak(currentQ.q)" style="padding:15px; margin-bottom:10px;">ğŸ”Š LISTEN TO CLIENT<br><small>è½å–å®¢æˆ¶å•é¡Œ</small></div><div style="background:#000; border:2px solid #fff; padding:10px; font-size:13px; flex-grow:1; overflow-y:auto;">${data.ts_note}</div><div id="rec-btn" class="arc-btn red" style="margin-top:10px;" onclick="rec(currentQ.a, this)">CHALLENGE!<br><small>éŒ„éŸ³å›ç­”</small></div><div class="arc-btn grey" style="margin-top:8px;" onclick="nextQ()">SKIP QUESTION / è·³é</div>`;
        }
    }

    function updateHP() {
        let eHP = 100 - (currentL === 3 ? (qCount / 4 * 100) : (currentStep / 3 * 100));
        document.getElementById('hp-enemy').style.width = eHP + "%";
    }

    function triggerEffect() {
        const f = document.getElementById('flash'); f.style.display = 'block'; setTimeout(() => f.style.display = 'none', 100);
        document.getElementById('game-body').classList.add('shake');
        setTimeout(() => document.getElementById('game-body').classList.remove('shake'), 300);
    }

    function showPop(title, mainText, success) {
        stopMic();
        document.getElementById('pop-title').innerText = title;
        let chiLine = "";
        if (title === "VICTORY!") { chiLine = "åšå¾—å¥½ï¼ä½ å·²ç¶“å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼"; }
        else if (title === "HINT") { chiLine = "é€™æ˜¯çµ¦ä½ çš„æç¤ºï¼"; } 
        else if (success) { chiLine = "åšå¾—å¥½ï¼ç¹¼çºŒä¸‹ä¸€é—œï¼"; } 
        else {
            if (currentL === 1) chiLine = "çµ„å¥ä¸å®Œå…¨æ­£ç¢ºï¼Œå†è©¦ä¸€æ¬¡ï¼";
            else if (currentL === 2) chiLine = "ç™¼éŸ³ä¸å¤ æº–ç¢ºï¼Œè«‹å†æŒ‘æˆ°ï¼";
            else chiLine = "å›ç­”éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç­†è¨˜å†è©¦ï¼";
        }
        document.getElementById('pop-text').innerHTML = `${mainText}<span class="chi-sub">${chiLine}</span>`;
        document.getElementById('pop-btn').innerText = (success || title === "VICTORY!") ? "CONTINUE / ç¹¼çºŒ" : "TRY AGAIN / é‡è©¦";
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
        shouldAutoNext = success;
        if(success) triggerEffect();
    }

    function closePopup() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('popup').style.display = 'none';
        if(isVictoryState) backToHome(); else if(shouldAutoNext) nextQ();
    }

    function checkL1() {
        const d = tasksData[currentTask].steps[currentStep];
        const ans = Array.from(document.getElementById('dz').querySelectorAll('.chip')).map(e => e.innerText).join(" ");
        if (ans.toLowerCase().replace(/[ ,.]/g,'') === d.correct.toLowerCase().replace(/[ ,.]/g,'')) showPop("PERFECT!", d.correct, true);
        else showPop("MISS!", "Sequence or Content error!", false);
    }

    function nextQ() {
        if(currentL === 1) { currentStep++; if(currentStep > 2) { currentStep = 0; currentL = 2; } }
        else if(currentL === 2) { currentStep++; if(currentStep > 2) { currentStep = 0; currentL = 3; } }
        else if(currentL === 3) { 
            qCount++; 
            if(qCount >= 4) { isVictoryState = true; showPop("VICTORY!", "ALL ROUNDS COMPLETED!", true); return; } 
        }
        render();
    }

    const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
    const recognition = (SpeechRecognition) ? new SpeechRecognition() : null;
    if (recognition) { recognition.lang = 'en-US'; }

    function rec(target, btn) {
        if(!recognition || isMicOn) return;
        isMicOn = true; btn.innerHTML = "FIGHTING...<br><small>æŒ‘æˆ°ä¸­</small>";
        recognition.start();
        recognition.onresult = (e) => {
            const res = e.results[0][0].transcript.toLowerCase(); stopMic();
            if(res.includes(target.toLowerCase().replace(/[.,!]/g, ''))) showPop("K.O.!", "Great Skill!", true);
            else showPop("BLOCK!", `You said: "${res}"`, false);
        };
        recognition.onspeechend = stopMic; recognition.onerror = stopMic;
    }

    function stopMic() { 
        isMicOn = false; 
        const btn = document.getElementById('rec-btn'); 
        if (btn) btn.innerHTML = (currentL === 3) ? "CHALLENGE!<br><small>éŒ„éŸ³å›ç­”</small>" : "SPEAKING FIGHT!<br><small>é–‹å§‹æŒ‘æˆ°</small>"; 
        if(recognition) try { recognition.stop(); } catch(e) {}
    }
</script>
</body>
</html>
